<!doctype html>
<html>
<head>
<title>Template</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bower_components/bootstrap/dist/css/bootstrap.min.css') }}">
<style type="text/css">
ul { list-style: none; }
li a {
  text-decoration: none;
  color: #333;
}
.list-section { margin-top: 30px; }
</style>
<body>
<div class="container">
  <h1>Todo Application</h1>
  <div class="row">
    <div class="col-xs-5">
      <input type="text" class="form-control" id="txt_newTask" placeholder="Task...">
    </div>
    <div class="col-xs-3">
      <button class="addTask btn btn-primary">Add Item</button>
    </div>
  </div>

  <br />
  <div class="col-md-6">
    <div class="row list-section">
      <ul id="todo-tasks" class="list-group">
      {% for item in tasks %}
        <li class="checkbox list-group-item" id="{{ item.id }}">
          <label>
            <input type="checkbox" {% if item.status %} checked {% endif %} />
            <a href="{{ item.url }}">{{ item.title }}</a>
          </label>
        </li>
      {% endfor %}
      </ul>
    </div>
  </div>

</div>
<script type="text/javascript" src="{{ url_for('static', filename='bower_components/jquery/dist/jquery.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='bower_components/bootstrap/dist/js/bootstrap.min.js') }}"></script>
<script type="text/javascript">

  $('input[type=text]').focus();

  function textRenderer(text) {
    var tarr1 = text.split('-'),
      tarr2 = tarr1[1].split('@'),
      title = tarr1[0],
      desc = tarr2[0],
      date = tarr2[1];
  }

  $('#txt_newTask').on('keydown', function(event) {
    // when user presses 'enter' key, trigger the add new item event
    if(event.keyCode === 13) $('button.addTask').trigger('click');
  })

  var Todo = function() {
    this.addItem = function(task) {
      return $.ajax('/tasks', {
        method: 'POST',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify({
          title: task.title || 'Default Title',
          desc: task.desc || 'Default Description.'
        })
      });
    };

    this.updateItem = function(taskID) {
      return $.ajax('/tasks', {
        method: 'PUT',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify({ id: taskID })
      });
    };

    this.deleteItem = function(taskID) {

    };

    this.getItems = function() {

    };
  };

  // Instance of the todo application
  var todo = new Todo();

  // Event
  $('button.addTask').on('click', ui_addTask);

  // Event Handlers
  function ui_addTask(event) {
    var newTask = {}, txtbox = $('#txt_newTask');
    newTask.title = txtbox.val();
    todo.addItem(newTask).done(function(result) {
      var check = (result.tasks.status === true) ? 'checked' : '';
      $("#todo-tasks").prepend('<li class="checkbox list-group-item" id="'+ result.tasks.id +'"><label><input type="checkbox" /><a href="'+ result.tasks.url +'">'+ result.tasks.title +'</a></label></li>');
      txtbox.val("");
    }).fail(function(errMsg) {
      alert('An error occured while adding new item to your list. Please try again.');
      console.log(errMsg);
    });
  }


</script>
</body>
</head>
</html>