<!doctype html>
<html>
<head>
<title>Template</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bower_components/bootstrap/dist/css/bootstrap.min.css') }}">
<style type="text/css">
ul { list-style: none; }
li a {
  text-decoration: none;
  color: #333;
}
.list-section { margin-top: 30px; }
</style>
<body>
<div class="container">
  <h1>Todo Application</h1>
  <input type="text" name="todo-title" id="task-title" />
  <input type="text" name="todo-desc" id="task-desc" />
  <button class="addTask">Add Item</button>
  <br />
  <div class="col-md-6">
    <div class="row list-section">
      <ul id="todo-tasks" class="list-group">
      {% for item in tasks %}
        <li class="list-group-item" id="{{ item.id }}"><input type="checkbox" {% if item.status %} checked {% endif %} /><a href="{{ item.url }}">{{ item.title }}</a></li>
      {% endfor %}
      </ul>
    </div>
  </div>

</div>
<script type="text/javascript" src="{{ url_for('static', filename='bower_components/jquery/dist/jquery.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='bower_components/bootstrap/dist/js/bootstrap.min.js') }}"></script>
<script type="text/javascript">

// Lets add a new task to the list
// $.ajax('/tasks', {
//   method: 'POST',
//   dataType: 'json',
//   contentType: 'application/json',
//   data: JSON.stringify({
//     title: 'Another Title',
//     desc: 'sample description about the task.'
//   })
// }).done(function(result) {
//   console.log(result);
//   debugger;
// }).fail(function(errorMsg) {
//   console.log(errorMsg);
// })

  var Todo = function() {
    this.addItem = function(task) {
      return $.ajax('/tasks', {
        method: 'POST',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify({
          title: task.title || 'Default Title',
          desc: task.desc || 'Default Description.'
        })
      });
    };

    this.updateItem = function(taskID) {
      return $.ajax('/tasks', {
        method: 'PUT',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify({ id: taskID })
      });
    };

    this.deleteItem = function(taskID) {

    };

    this.getItems = function() {

    };
  };

  // Instance of the todo application
  var todo = new Todo();

  // Event
  $('button.addTask').on('click', ui_addTask);

  // Event Handlers
  function ui_addTask(event) {
    var newTask = {};
    newTask.title = $('#task-title').val();
    newTask.desc = $('#task-desc').val();

    todo.addItem(newTask).done(function(result) {
      console.log(result);
      var check = (result.tasks.status === true) ? 'checked' : '';
      $("#todo-tasks").append('<li class="list-group-item" id="'+ result.tasks.id +'"><input type="checkbox" /><a href="'+ result.tasks.url +'">'+ result.tasks.title +'</a></li>');
    }).fail(function(errMsg) {
      alert('An error occured while adding new item to your list. Please try again.');
      console.log(errMsg);
    });
  } 
</script>
</body>
</head>
</html>